<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Geovisualization Final Project</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css" />
    <link rel="stylesheet" href="leaflet-easy-button.css"/>
    <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"></script>
    <script src="earthquake.js"></script>
    <script src="CaliCounty.js"></script>
    <script src="leaflet-easy-button.js"></script>
    <script src="leaflet-tag-filter-button.js"></script>
    <style>
        #mapid {
            width: 1500px;
            height: 850px;
        }
    </style>
</head>

<body>
    <h1>California Earthquakes</h1>
    <div id="mapid"></div>

    <div id="slidecontainer">
        <input type="range" min="1" max="100" value="50" class="slider" id="myRange">
      </div>

    <script>
        //this is the map
        var myMap = L.map('defaultMap').setView([36.778, -119.417], 6);
        
        //Start by creating the geoJSON layer
        var geoLayer = L.geoJSON().addTo(myMap);
        
  ////////////////////////////////////////////////////////////////////////////////
 //                       //SLIDER INFORMATION                                 //
////////////////////////////////////////////////////////////////////////////////
        var slider = document.getElementById("myRange");
        slider.oninput = function() {
            //clears the geo Layer
            geoLayer.clearLayers();
            //TODO: if date != slide date, remove popup
            L.geoJSON(MapData, {
                //filter out everything that doesn't match the slider date
                filter: function(feature, layer) {
                    return (new Date(feature.properties.time).getYear() == slider.value);
                }
                //bind pop-ups
            }).bindPopup(function(layer) {
                return "<dl><dt>Location:   " + layer.feature.properties.place + "</dt>"
                    +"<dt>Magnitude:   " + layer.feature.properties.mag + "</dt>"
                    +"<dt>Time:   " + new Date(layer.feature.properties.time) + "</dt></dl>";
			}).addTo(geoLayer); //dump it all in the geolayer;
        }


        var mymap = L.map('mapid').setView([36.778, -119.417], 6);

        var Esri_WorldGrayCanvas = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}', {
            attribution: 'Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ',
            maxZoom: 16
        }).addTo(mymap);

        L.control.tagFilterButton({
            data: ['0-6', '6+', 'none'],
            icon: '<img src="filter.png">',
            filterOnEveryClick: true
        }).addTo( mymap );


  ////////////////////////////////////////////////////////////////////////////////
 //                 //setting up the aesthetic stuff//                         //
////////////////////////////////////////////////////////////////////////////////
//define styles for circle markers
        var dotStyleDefault = {
            radius: 5,
            fillColor: "#20a0ff",
            color: "#000",
            weight: 0,
            opacity: 1,
            fillOpacity: 0.9
        };

        var dotStyleHighlight = {
            radius: 6,
            fillColor: "#20a0ff",
            color: "#22c",
            weight: 1,
            opacity: 1,
            fillOpacity: 0.9
        };

        var gdotStyleDefault = {
            radius: 5,
            fillColor: "#40b060",
            color: "#000",
            weight: 0,
            opacity: 1,
            fillOpacity: 0.9
        };

        var gdotStyleHighlight = {
            radius: 6,
            fillColor: "#40b060",
            color: "#22c",
            weight: 1,
            opacity: 1,
            fillOpacity: 0.9
        };

        //functions to attach styles and popups to the marker layer
        function highlightDot(e) {
            var layer = e.target;

            layer.setStyle(dotStyleHighlight);

            if (!L.Browser.ie && !L.Browser.opera) {
                layer.bringToFront();
            }
        }

        function resetDotHighlight(e) {
            var layer = e.target;
            layer.setStyle(dotStyleDefault);
        }
        ///THIS IS WHERE THE NEW POPUPS ARE!!!!
        function onEachDot(feature, layer) {
            layer.on({
                mouseover: highlightDot,
                mouseout: resetDotHighlight
            });
            layer.bindPopup("<dl><dt>Location:   " + feature.properties.place + "</dt>"
                    +"<dt>Magnitude:   " + feature.properties.mag + "</dt>"
                    +"<dt>Time:   " + new Date(feature.properties.time) + "</dt></dl>");
        }

  ////////////////////////////////////////////////////////////////////////////////
 //                     //DONE WITH AESTHETICS!!                               //
////////////////////////////////////////////////////////////////////////////////
        dotlayer = L.geoJson(MapData, {
            pointToLayer: function (feature, coordinates) {         // This line is wehre it calls the coordinates for the data points for earthquakes
                return L.circleMarker(coordinates, dotStyleDefault); // This line pulls the circlemarkers.
                },
            onEachFeature: L.geoJSON(MapData, { OPTIONS }).bindPopup().addTo(geoLayer)
        }).addTo(mymap);

        var overlayMaps = {
            '<div class="dotLegend dotColor"></div> The Blue Dots': 
            dotlayer,
            '<div class="dotLegend gdotColor"></div> The Green Dots': 
            gdotlayer
        };

        layerbox = L.control.layers(null, overlayMaps, {collapsed: 
        false}).addTo(map);
/////////////// TEST LAYERS FOR NEW MAP DATA /////////////
/////////////////////////////////////////////////////////

        //This is the county data but it breaks right now
        //L.geoJSON(countyData).addTo(mymap);
               
    </script>

</body>


</html>
